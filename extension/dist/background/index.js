(()=>{"use strict";function e(){const e=new Date,o=new Date(e);return o.setDate(o.getDate()+1),o.setHours(0,0,0,0),o.getTime()}chrome.runtime.onInstalled.addListener((()=>{const o=(new Date).toISOString().split("T")[0];chrome.storage.local.set({currentTodos:[],todoHistory:{[o]:[]}}),chrome.alarms.create("daily-refresh",{periodInMinutes:1440,when:e()})})),chrome.alarms.onAlarm.addListener((async e=>{if("daily-refresh"===e.name){const{currentTodos:e}=await chrome.storage.local.get("currentTodos"),{todoHistory:o}=await chrome.storage.local.get("todoHistory"),t=(new Date).toISOString().split("T")[0],r={...o,[t]:e},s=e.map((e=>({...e,completed:!1})));await chrome.storage.local.set({currentTodos:s,todoHistory:r})}else e.name.startsWith("todo-")&&chrome.notifications.create(e.name,{type:"basic",iconUrl:"icons/icon128.png",title:"Todo Reminder",message:"You have a pending todo item!",priority:2})})),chrome.runtime.onMessage.addListener(((e,o,t)=>{if(console.log("Background script received message:",e),"CLOSE_MATCHING_TABS"===e.type&&e.url)return chrome.tabs.query({},(o=>{const r=[];o.forEach((o=>{o.url?.includes(e.url)&&(console.log("Closing tab:",o.url),chrome.tabs.remove(o.id),r.push(o.url))})),t({success:!0,closedTabs:r})})),!0}))})();