(()=>{"use strict";function e(){const e=new Date,t=new Date(e);return t.setDate(t.getDate()+1),t.setHours(0,0,0,0),t.getTime()}chrome.runtime.onInstalled.addListener((()=>{const t=(new Date).toISOString().split("T")[0];chrome.storage.local.set({currentRoutines:[],routineHistory:{[t]:[]}}),chrome.alarms.create("daily-refresh",{periodInMinutes:1440,when:e()})})),chrome.alarms.onAlarm.addListener((async e=>{if("daily-refresh"===e.name){const{currentRoutines:e}=await chrome.storage.local.get("currentRoutines"),{routineHistory:t}=await chrome.storage.local.get("routineHistory"),r=(new Date).toISOString().split("T")[0],o={...t,[r]:e},s=e.map((e=>({...e,completed:!1})));await chrome.storage.local.set({currentRoutines:s,routineHistory:o})}else e.name.startsWith("routine-")&&chrome.notifications.create(e.name,{type:"basic",iconUrl:"icons/icon128.png",title:"Routine Reminder",message:"You have a pending routine item!",priority:2})})),chrome.runtime.onMessage.addListener(((e,t,r)=>{if(console.log("Background script received message:",e),"CLOSE_MATCHING_TABS"===e.type&&e.url)return chrome.tabs.query({},(t=>{const o=[];t.forEach((t=>{t.url?.includes(e.url)&&(console.log("Closing tab:",t.url),chrome.tabs.remove(t.id),o.push(t.url))})),r({success:!0,closedTabs:o})})),!0}))})();